<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WACS - Mapa Acessível</title>
    <link rel="stylesheet" href="../public/css/main.css">
    <link rel="stylesheet" href="../public/css/navbar.css">
    <link rel="stylesheet" href="../public/css/footer.css">
    <link rel="stylesheet" href="../public/css/transitions.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        .locations-container {
            max-width: 100%;
            margin: 20px auto;
            padding: 20px;
            overflow-x: hidden;
        }

        .filters-section {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .filter-group label {
            font-weight: 500;
            color: var(--text-color);
        }

        .filter-group select,
        .filter-group input {
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--input-bg);
            color: var(--text-color);
        }

        .search-bar {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            margin-bottom: 15px;
            background: var(--input-bg);
            color: var(--text-color);
        }

        #locationsList {
            display: flex;
            gap: 20px;
            padding: 20px 0;
            overflow-x: auto;
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
            scrollbar-color: var(--accent-color) var(--card-bg);
            justify-content: center;
        }

        #locationsList::-webkit-scrollbar {
            height: 8px;
        }

        #locationsList::-webkit-scrollbar-track {
            background: var(--card-bg);
            border-radius: 4px;
        }

        #locationsList::-webkit-scrollbar-thumb {
            background: var(--accent-color);
            border-radius: 4px;
        }

        .location-card {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            min-width: 300px;
            max-width: 300px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
            flex: 0 0 auto;
        }

        .location-card:hover {
            transform: translateY(-2px);
        }

        .location-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .location-name {
            font-size: 1.2em;
            font-weight: 600;
            color: var(--text-color);
        }

        .location-rating {
            color: #ffd700;
        }

        .location-details {
            color: var(--text-color);
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .accessibility-features {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .feature-tag {
            background: var(--accent-color);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
            font-size: 0.9em;
            color: var(--text-secondary);
        }

        .user-avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--accent-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8em;
        }

        .scroll-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .scroll-button {
            background: var(--accent-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .scroll-button:hover {
            background: var(--accent-color-dark);
        }

        .map-container {
            width: 100%;
            max-width: 1200px;
            height: 400px;
            margin: 0 auto 32px auto;
            border-radius: 12px;
            overflow: hidden;
            background: #222; /* fallback para dark */
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
    </style>
</head>
<body class="fade-in">
    <div class="main-container">
        <nav class="navbar">
            <button class="menu-toggle-btn">
                <i class="fas fa-bars"></i>
            </button>
            <div class="navbar-logo">
                <i class="fas fa-wheelchair"></i>
                <span>WACS</span>
            </div>
            <ul class="navbar-menu">
                <li data-page="home"><a href="../index.html">Home</a></li>
                <li data-page="recursos"><a href="recursos.html">Recursos</a></li>
                <li data-page="comunidade"><a href="comunidade.html">Comunidade</a></li>
                <li data-page="mapa"><a href="mapa-acessivel.html">Mapa Acessível</a></li>
                <li data-page="about"><a href="about.html">Sobre</a></li>
            </ul>
            <div class="navbar-actions">
                <button class="theme-toggle-btn">
                    <i class="fas fa-sun"></i>
                </button>
                <div class="mobile-user-status">
                    <img src="" alt="Foto de Perfil" class="profile-pic-mobile hidden">
                    <button class="btn btn-outline-gradient login-btn-mobile hidden" onclick="location.href='user/login.html'">Login</button>
                </div>
                <div class="logged-out-actions">
                    <button class="btn btn-gradient" onclick="location.href='user/login.html'">Acessar Plataforma</button>
                </div>
                <div class="logged-in-actions hidden">
                    <div class="user-profile">
                        <img src="" alt="Foto de Perfil" class="profile-pic">
                        <span class="user-name"></span>
                    </div>
                    <button class="btn btn-outline-gradient logout-btn">Sair</button>
                </div>
            </div>
        </nav>

        <div class="mobile-menu-overlay">
            <div class="mobile-menu-header">
                <div class="navbar-logo">
                    <i class="fas fa-wheelchair"></i>
                    <span>WACS</span>
                </div>
                <button class="close-menu-btn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <ul class="mobile-navbar-menu">
                <li data-page="home"><a href="../index.html">Home</a></li>
                <li data-page="recursos"><a href="recursos.html">Recursos</a></li>
                <li data-page="comunidade"><a href="comunidade.html">Comunidade</a></li>
                <li data-page="mapa"><a href="mapa-acessivel.html">Mapa Acessível</a></li>
                <li data-page="about"><a href="about.html">Sobre</a></li>
            </ul>
            <div class="mobile-navbar-actions">
                <div class="logged-out-actions-mobile">
                    <button class="btn btn-gradient" onclick="location.href='user/login.html'">Acessar Plataforma</button>
                </div>
                <div class="logged-in-actions-mobile hidden">
                    <div class="user-profile">
                        <img src="" alt="Foto de Perfil" class="profile-pic">
                        <span class="user-name"></span>
                    </div>
                    <button class="btn btn-outline-gradient logout-btn">Sair</button>
                </div>
            </div>
        </div>

        <section class="page-content">
            <h1 style="text-align: center;">Mapa Acessível</h1>
            <p style="text-align: center;">Encontre locais acessíveis próximos a você e compartilhe suas experiências!</p>
            <div class="locations-container">
                <div class="filters-section">
                    <input type="text" class="search-bar" placeholder="Buscar locais..." id="searchInput">
                    
                    <div class="filters-grid">
                        <div class="filter-group">
                            <label for="typeFilter">Tipo de Local</label>
                            <select id="typeFilter">
                                <option value="">Todos</option>
                                <option value="shopping">Shopping</option>
                                <option value="restaurante">Restaurante</option>
                                <option value="parque">Parque</option>
                                <option value="teatro">Teatro</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label for="ratingFilter">Avaliação Mínima</label>
                            <select id="ratingFilter">
                                <option value="0">Todas</option>
                                <option value="3">3+ estrelas</option>
                                <option value="4">4+ estrelas</option>
                                <option value="4.5">4.5+ estrelas</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label for="featureFilter">Recurso de Acessibilidade</label>
                            <select id="featureFilter">
                                <option value="">Todos</option>
                                <option value="rampa">Rampas</option>
                                <option value="elevador">Elevadores</option>
                                <option value="braile">Braile</option>
                                <option value="libras">Libras</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div id="locationsList">
                    <!-- Shopping Center -->
                    <div class="location-card" data-type="shopping" data-rating="4.5" data-features="rampa,elevador,braile">
                        <div class="location-header">
                            <span class="location-name">Shopping Center Acessível</span>
                            <span class="location-rating">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star-half-alt"></i>
                                4.5
                            </span>
                        </div>
                        <div class="location-details">
                            <p><i class="fas fa-map-marker-alt"></i> Av. Principal, 1000 - Centro</p>
                            <p><i class="fas fa-comment"></i> "Excelente estrutura de acessibilidade, com rampas e elevadores em todos os níveis."</p>
                        </div>
                        <div class="accessibility-features">
                            <span class="feature-tag">Rampas</span>
                            <span class="feature-tag">Elevadores</span>
                            <span class="feature-tag">Sinalização em Braile</span>
                            <span class="feature-tag">Vagas Preferenciais</span>
                        </div>
                        <div class="user-info">
                            <div class="user-avatar">JD</div>
                            <span>João Dias - 2 dias atrás</span>
                        </div>
                    </div>

                    <!-- Restaurante -->
                    <div class="location-card" data-type="restaurante" data-rating="4.0" data-features="libras,braile">
                        <div class="location-header">
                            <span class="location-name">Restaurante Inclusivo</span>
                            <span class="location-rating">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="far fa-star"></i>
                                4.0
                            </span>
                        </div>
                        <div class="location-details">
                            <p><i class="fas fa-map-marker-alt"></i> Rua das Flores, 500 - Jardim</p>
                            <p><i class="fas fa-comment"></i> "Cardápio em braile e funcionários treinados em libras. Ambiente muito acolhedor!"</p>
                        </div>
                        <div class="accessibility-features">
                            <span class="feature-tag">Cardápio em Braile</span>
                            <span class="feature-tag">Atendimento em Libras</span>
                            <span class="feature-tag">Mesa Adaptada</span>
                        </div>
                        <div class="user-info">
                            <div class="user-avatar">MS</div>
                            <span>Maria Silva - 1 semana atrás</span>
                        </div>
                    </div>

                    <!-- Parque -->
                    <div class="location-card" data-type="parque" data-rating="5.0" data-features="rampa">
                        <div class="location-header">
                            <span class="location-name">Parque Municipal</span>
                            <span class="location-rating">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                5.0
                            </span>
                        </div>
                        <div class="location-details">
                            <p><i class="fas fa-map-marker-alt"></i> Av. dos Ipês, 2000 - Parque</p>
                            <p><i class="fas fa-comment"></i> "Trilhas adaptadas e equipamentos inclusivos para todas as idades. Um exemplo de inclusão!"</p>
                        </div>
                        <div class="accessibility-features">
                            <span class="feature-tag">Trilhas Adaptadas</span>
                            <span class="feature-tag">Equipamentos Inclusivos</span>
                            <span class="feature-tag">Banheiros Adaptados</span>
                        </div>
                        <div class="user-info">
                            <div class="user-avatar">PL</div>
                            <span>Pedro Lima - 3 dias atrás</span>
                        </div>
                    </div>

                    <!-- Teatro -->
                    <div class="location-card" data-type="teatro" data-rating="4.8" data-features="elevador,libras">
                        <div class="location-header">
                            <span class="location-name">Teatro Municipal</span>
                            <span class="location-rating">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                4.8
                            </span>
                        </div>
                        <div class="location-details">
                            <p><i class="fas fa-map-marker-alt"></i> Praça da Cultura, 100 - Centro</p>
                            <p><i class="fas fa-comment"></i> "Espetáculos com interpretação em libras e lugares reservados para cadeirantes."</p>
                        </div>
                        <div class="accessibility-features">
                            <span class="feature-tag">Interpretação em Libras</span>
                            <span class="feature-tag">Elevadores</span>
                            <span class="feature-tag">Lugares Reservados</span>
                        </div>
                        <div class="user-info">
                            <div class="user-avatar">AC</div>
                            <span>Ana Costa - 5 dias atrás</span>
                        </div>
                    </div>
                </div>
                <div class="scroll-buttons">
                    <button class="scroll-button" onclick="scrollLeft()">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button class="scroll-button" onclick="scrollRight()">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                <div style="margin-top: 48px; margin-bottom: 16px; text-align: center;">
                    <h2 style="font-size: 2rem; font-weight: 700; margin-bottom: 8px; letter-spacing: -1px;">Mapa de Locais Acessíveis</h2>
                    <p style="color: var(--text-secondary, #aaa); font-size: 1.05rem;">Veja no mapa os locais cadastrados pela comunidade</p>
                </div>
                <div class="map-container">
                    <p>O mapa será carregado aqui</p>
                </div>
            </div>
        </section>

    </div>

    <footer class="footer">
        <div class="footer-container">
            <div class="footer-brand">
                <i class="fas fa-wheelchair"></i>
                <span>WACS</span>
                <p>Inovando na mobilidade acessível.</p>
            </div>
            <div class="footer-links">
                <h3>Links Rápidos</h3>
                <ul>
                    <li><a href="../index.html#home">Home</a></li>
                    <li><a href="recursos.html">Recursos</a></li>
                    <li><a href="comunidade.html">Comunidade</a></li>
                    <li><a href="mapa-acessivel.html">Mapa Acessível</a></li>
                </ul>
            </div>
            <div class="footer-contact">
                <h3>Contato</h3>
                <p>Email: contato@wacs.com</p>
                <p>Telefone: (XX) XXXX-XXXX</p>
                <div class="social-icons">
                    <a href="#"><i class="fab fa-facebook-f"></i></a>
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fab fa-instagram"></i></a>
                    <a href="#"><i class="fab fa-linkedin-in"></i></a>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2024 WACS. Todos os direitos reservados.</p>
            <p class="alpha-footer-notice">Esta é uma versão Alpha. Para feedback, entre em contato.</p>
        </div>
    </footer>

    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script src="../public/js/env-config.js"></script>
    <script src="../public/js/auth-check.js"></script>
    <script src="../public/js/script.js"></script>
    <div class="theme-transition-overlay"></div>

    <script>
        // Filtros
        const searchInput = document.getElementById('searchInput');
        const typeFilter = document.getElementById('typeFilter');
        const ratingFilter = document.getElementById('ratingFilter');
        const featureFilter = document.getElementById('featureFilter');
        const locationsList = document.getElementById('locationsList');
        const scrollButtons = document.querySelectorAll('.scroll-button');
        const leftButton = scrollButtons[0];
        const rightButton = scrollButtons[1];
        const allCards = Array.from(locationsList.getElementsByClassName('location-card'));
        let filteredCards = [...allCards];
        let currentPage = 0;
        const cardsPerPage = 3;

        function updatePaginationButtons() {
            const totalPages = Math.ceil(filteredCards.length / cardsPerPage);
            leftButton.disabled = currentPage === 0;
            rightButton.disabled = currentPage >= totalPages - 1 || totalPages === 0;
        }

        function showPage(page) {
            const totalPages = Math.ceil(filteredCards.length / cardsPerPage);
            if (page < 0) page = 0;
            if (page >= totalPages) page = totalPages - 1;
            currentPage = page;
            filteredCards.forEach((card, i) => {
                if (i >= page * cardsPerPage && i < (page + 1) * cardsPerPage) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
            updatePaginationButtons();
        }

        function filterLocations() {
            const searchTerm = searchInput.value.toLowerCase();
            const selectedType = typeFilter.value;
            const minRating = parseFloat(ratingFilter.value);
            const selectedFeature = featureFilter.value;

            filteredCards = allCards.filter(card => {
                const name = card.querySelector('.location-name').textContent.toLowerCase();
                const type = card.dataset.type;
                const rating = parseFloat(card.dataset.rating);
                const features = card.dataset.features.split(',');

                const matchesSearch = name.includes(searchTerm);
                const matchesType = !selectedType || type === selectedType;
                const matchesRating = rating >= minRating;
                const matchesFeature = !selectedFeature || features.includes(selectedFeature);

                return matchesSearch && matchesType && matchesRating && matchesFeature;
            });
            currentPage = 0;
            showPage(currentPage);
        }

        searchInput.addEventListener('input', filterLocations);
        typeFilter.addEventListener('change', filterLocations);
        ratingFilter.addEventListener('change', filterLocations);
        featureFilter.addEventListener('change', filterLocations);

        leftButton.addEventListener('click', () => {
            if (currentPage > 0) {
                showPage(currentPage - 1);
            }
        });
        rightButton.addEventListener('click', () => {
            const totalPages = Math.ceil(filteredCards.length / cardsPerPage);
            if (currentPage < totalPages - 1) {
                showPage(currentPage + 1);
            }
        });

        // Inicialização
        filterLocations();
    </script>
    <!-- Google Maps Script (adaptado do dashboard) -->
    <script>
        function loadGoogleMapsScriptAccessible() {
            if (document.getElementById('google-maps-script-accessible')) return;
            const script = document.createElement('script');
            script.id = 'google-maps-script-accessible';
            script.src = `https://maps.googleapis.com/maps/api/js?key=${window.ENV.GOOGLE_MAPS_API_KEY}&libraries=places&callback=initAccessibleMap`;
            script.async = true;
            script.defer = true;
            document.head.appendChild(script);
        }
        window.accessibleMap = undefined;
        window.accessibleMapMarkers = [];
        function initAccessibleMap() {
            const darkMapStyles = [
                { elementType: "geometry", stylers: [{ color: "#242f3e" }] },
                { elementType: "labels.text.stroke", stylers: [{ color: "#242f3e" }] },
                { elementType: "labels.text.fill", stylers: [{ color: "#ffffff" }] },
                { featureType: "administrative.locality", elementType: "labels.text.fill", stylers: [{ color: "#d59563" }] },
                { featureType: "poi", elementType: "labels.text.fill", stylers: [{ color: "#d59563" }] },
                { featureType: "poi.park", elementType: "geometry", stylers: [{ color: "#263c3f" }] },
                { featureType: "poi.park", elementType: "labels.text.fill", stylers: [{ color: "#6b9a76" }] },
                { featureType: "road", elementType: "geometry", stylers: [{ color: "#38414e" }] },
                { featureType: "road", elementType: "geometry.stroke", stylers: [{ color: "#212a37" }] },
                { featureType: "road", elementType: "labels.text.fill", stylers: [{ color: "#9ca5b3" }] },
                { featureType: "road.highway", elementType: "geometry", stylers: [{ color: "#746855" }] },
                { featureType: "road.highway", elementType: "geometry.stroke", stylers: [{ color: "#1f2835" }] },
                { featureType: "road.highway", elementType: "labels.text.fill", stylers: [{ color: "#f3d19c" }] },
                { featureType: "transit", elementType: "geometry", stylers: [{ color: "#2f3948" }] },
                { featureType: "transit.station", elementType: "labels.text.fill", stylers: [{ color: "#d59563" }] },
                { featureType: "water", elementType: "geometry", stylers: [{ color: "#17263c" }] },
                { featureType: "water", elementType: "labels.text.fill", stylers: [{ color: "#ffffff" }] },
                { featureType: "water", elementType: "labels.text.stroke", stylers: [{ color: "#17263c" }] }
            ];
            const lightMapStyles = [];
            document.removeEventListener('themechange', window._wacs_accessible_map_theme_listener);
            window._wacs_accessible_map_theme_listener = function() {
                if (window.accessibleMap) {
                    const isDark = document.body.classList.contains('dark-theme');
                    window.accessibleMap.setOptions({ styles: isDark ? darkMapStyles : lightMapStyles });
                }
            };
            document.addEventListener('themechange', window._wacs_accessible_map_theme_listener);
            const mapContainer = document.querySelector('.map-container');
            if (mapContainer) {
                mapContainer.innerHTML = '';
                const mapOptions = {
                    center: { lat: -24.4874, lng: -47.8446 },
                    zoom: 14,
                    mapTypeId: google.maps.MapTypeId.ROADMAP,
                    mapTypeControl: true,
                    streetViewControl: false,
                    fullscreenControl: true
                };
                window.accessibleMap = new google.maps.Map(mapContainer, mapOptions);
                const isDark = document.body.classList.contains('dark-theme');
                window.accessibleMap.setOptions({ styles: isDark ? darkMapStyles : lightMapStyles });
                loadLocationsForAccessibleMap();
            }
        }
        function loadLocationsForAccessibleMap() {
            if (!window.accessibleMap) return;
            window.accessibleMapMarkers.forEach(marker => marker.setMap(null));
            window.accessibleMapMarkers = [];
            if (!firebase || !firebase.firestore) return;
            firebase.firestore().collection('accessibleLocations')
                .get()
                .then((querySnapshot) => {
                    const bounds = new google.maps.LatLngBounds();
                    let hasLocations = false;
                    querySnapshot.forEach((doc) => {
                        const data = doc.data();
                        if (data.location) {
                            hasLocations = true;
                            const position = {
                                lat: data.location.latitude,
                                lng: data.location.longitude
                            };
                            const marker = new google.maps.Marker({
                                position: position,
                                map: window.accessibleMap,
                                title: data.name,
                                animation: google.maps.Animation.DROP
                            });
                            const rating = data.rating || 0;
                            const reviewCount = data.reviewCount || 0;
                            const imageUrl = data.imageUrl || data.image || data.photoUrl || '';
                            let ratingStars = '';
                            for (let i = 1; i <= 5; i++) {
                                if (i <= Math.floor(rating)) {
                                    ratingStars += '<i class="fas fa-star" style="color: #fbbf24;"></i>';
                                } else if (i === Math.ceil(rating) && rating % 1 !== 0) {
                                    ratingStars += '<i class="fas fa-star-half-alt" style="color: #fbbf24;"></i>';
                                } else {
                                    ratingStars += '<i class="far fa-star" style="color: #d1d5db;"></i>';
                                }
                            }
                            // Detecta tema para InfoWindow
                            const isDark = document.body.classList.contains('dark-theme');
                            const infoTextColor = isDark ? '#fff' : '#222';
                            const infowindow = new google.maps.InfoWindow({
                                content: `
                                    <div class='map-info-window' style='color: ${infoTextColor}; max-width: 280px;'>
                                        <h3 style='color: ${infoTextColor}; margin-bottom: 8px;'>${data.name}</h3>
                                        ${imageUrl ? `<img src="${imageUrl}" alt="Foto de ${data.name}" style="width:100%;height:120px;object-fit:cover;border-radius:8px;margin-bottom:8px;" onerror="this.style.display='none'">` : ''}
                                        <p style='margin: 4px 0;'><strong>Endereço:</strong> ${data.address}</p>
                                        <p style='margin: 4px 0;'><strong>Recursos:</strong> ${data.features}</p>
                                        <div style='margin-top:8px;'>
                                            ${ratingStars}
                                            <span style='margin-left:6px;font-size:13px;'>
                                                ${rating.toFixed(1)} (${reviewCount} ${reviewCount === 1 ? 'avaliação' : 'avaliações'})
                                            </span>
                                        </div>
                                    </div>
                                `
                            });
                            marker.addListener('click', function() {
                                infowindow.open(window.accessibleMap, marker);
                            });
                            window.accessibleMapMarkers.push(marker);
                            bounds.extend(position);
                        }
                    });
                    if (hasLocations) {
                        window.accessibleMap.fitBounds(bounds);
                        const listener = google.maps.event.addListener(window.accessibleMap, 'idle', function() {
                            if (window.accessibleMap.getZoom() > 16) {
                                window.accessibleMap.setZoom(16);
                            }
                            google.maps.event.removeListener(listener);
                        });
                    }
                })
                .catch((error) => {
                    console.error('Erro ao carregar locais para o mapa:', error);
                });
        }
        if (window.ENV && window.ENV.GOOGLE_MAPS_API_KEY) {
            loadGoogleMapsScriptAccessible();
        } else {
            window.addEventListener('DOMContentLoaded', function() {
                if (window.ENV && window.ENV.GOOGLE_MAPS_API_KEY) {
                    loadGoogleMapsScriptAccessible();
                } else {
                    console.error('Google Maps API key não encontrada nas variáveis de ambiente');
                }
            });
        }
    </script>
</body>
</html> 